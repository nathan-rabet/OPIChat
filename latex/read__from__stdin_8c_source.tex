\hypertarget{read__from__stdin_8c_source}{}\doxysection{read\+\_\+from\+\_\+stdin.\+c}
\label{read__from__stdin_8c_source}\index{src/client/read\_from\_stdin.c@{src/client/read\_from\_stdin.c}}
\mbox{\hyperlink{read__from__stdin_8c}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00001}00001 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{read__from__stdin_8h}{read\_from\_stdin.h}}"{}}}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00002}00002 }
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00003}00003 \textcolor{preprocessor}{\#include <stdbool.h>}}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00004}00004 \textcolor{preprocessor}{\#include <stdio.h>}}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00005}00005 \textcolor{preprocessor}{\#include <stdlib.h>}}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00006}00006 \textcolor{preprocessor}{\#include <string.h>}}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00007}00007 \textcolor{preprocessor}{\#include <unistd.h>}}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00008}00008 }
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00009}00009 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{client__read_8h}{client\_read.h}}"{}}}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00010}00010 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{init__socket_8h}{init\_socket.h}}"{}}}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00011}00011 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{logger_8h}{logger.h}}"{}}}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00012}00012 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{message_8h}{message.h}}"{}}}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00013}00013 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{my__itoa_8h}{my\_itoa.h}}"{}}}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00014}00014 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{safe__io_8h}{safe\_io.h}}"{}}}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00015}00015 \textcolor{preprocessor}{\#include "{}xalloc.h"{}}}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00016}00016 }
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00017}00017 \textcolor{keyword}{extern} \textcolor{keywordtype}{int} \mbox{\hyperlink{read__from__stdin_8c_a9329c4790c307301a22f6d23cdc23edd}{server\_socket}};}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00018}00018 }
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00019}\mbox{\hyperlink{structcommand__parameters}{00019}} \textcolor{keyword}{struct }\mbox{\hyperlink{structcommand__parameters}{command\_parameters}}}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00020}00020 \{}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00021}\mbox{\hyperlink{structcommand__parameters_ade9cba72805fe52685a1deea307a8e82}{00021}}     \textcolor{keywordtype}{char} *\mbox{\hyperlink{structcommand__parameters_ade9cba72805fe52685a1deea307a8e82}{command}}; \textcolor{comment}{// NULL if invalid}}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00022}\mbox{\hyperlink{structcommand__parameters_a1d5849d3100a3edfcf71b7f6d93d1fd7}{00022}}     uint8\_t \mbox{\hyperlink{structcommand__parameters_a1d5849d3100a3edfcf71b7f6d93d1fd7}{nb\_parameters}};}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00023}\mbox{\hyperlink{structcommand__parameters_a3f1b143d5bfbd65ef665826a134dc7c0}{00023}}     \textcolor{keywordtype}{char} **\mbox{\hyperlink{structcommand__parameters_a3f1b143d5bfbd65ef665826a134dc7c0}{parameters\_name}};}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00024}\mbox{\hyperlink{structcommand__parameters_a218054f50dabee86e0bb149961430370}{00024}}     \textcolor{keywordtype}{bool} \mbox{\hyperlink{structcommand__parameters_a218054f50dabee86e0bb149961430370}{loop\_payload}};}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00025}00025 \};}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00026}00026 }
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00027}00027 \textcolor{comment}{// TODO : Do not use the heap, use a fixed size array instead}}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00028}00028 \textcolor{keyword}{static} \textcolor{keyword}{struct }\mbox{\hyperlink{structcommand__parameters}{command\_parameters}} *}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00029}00029 get\_command\_parameters\_info(\textcolor{keywordtype}{char} *command\_string)}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00030}00030 \{}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00031}00031     \textcolor{keyword}{struct }\mbox{\hyperlink{structcommand__parameters}{command\_parameters}} *cmd\_params =}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00032}00032         \mbox{\hyperlink{epoll__server_2utils_2xalloc_8c_a64dbeff7c3555eb2cb5991583d733f5a}{xcalloc}}(1, \textcolor{keyword}{sizeof}(\textcolor{keyword}{struct} \mbox{\hyperlink{structcommand__parameters}{command\_parameters}}));}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00033}00033     \textcolor{keywordflow}{if} (command\_string != NULL)}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00034}00034     \{}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00035}00035         \textcolor{keywordflow}{if} (strcmp(command\_string, \textcolor{stringliteral}{"{}LOGIN"{}}) == 0)}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00036}00036             cmd\_params-\/>\mbox{\hyperlink{structcommand__parameters_ade9cba72805fe52685a1deea307a8e82}{command}} = \textcolor{stringliteral}{"{}LOGIN"{}};}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00037}00037         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (strcmp(command\_string, \textcolor{stringliteral}{"{}PING"{}}) == 0)}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00038}00038             cmd\_params-\/>\mbox{\hyperlink{structcommand__parameters_ade9cba72805fe52685a1deea307a8e82}{command}} = \textcolor{stringliteral}{"{}PING"{}};}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00039}00039         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (strcmp(command\_string, \textcolor{stringliteral}{"{}LIST-\/USERS"{}}) == 0)}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00040}00040             cmd\_params-\/>\mbox{\hyperlink{structcommand__parameters_ade9cba72805fe52685a1deea307a8e82}{command}} = \textcolor{stringliteral}{"{}LIST-\/USERS"{}};}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00041}00041         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (strcmp(command\_string, \textcolor{stringliteral}{"{}BROADCAST"{}}) == 0)}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00042}00042         \{}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00043}00043             cmd\_params-\/>\mbox{\hyperlink{structcommand__parameters_a218054f50dabee86e0bb149961430370}{loop\_payload}} = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00044}00044             cmd\_params-\/>\mbox{\hyperlink{structcommand__parameters_ade9cba72805fe52685a1deea307a8e82}{command}} = \textcolor{stringliteral}{"{}BROADCAST"{}};}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00045}00045         \}}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00046}00046         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (strcmp(command\_string, \textcolor{stringliteral}{"{}SEND-\/DM"{}}) == 0)}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00047}00047         \{}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00048}00048             cmd\_params-\/>\mbox{\hyperlink{structcommand__parameters_a218054f50dabee86e0bb149961430370}{loop\_payload}} = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00049}00049             cmd\_params-\/>\mbox{\hyperlink{structcommand__parameters_ade9cba72805fe52685a1deea307a8e82}{command}} = \textcolor{stringliteral}{"{}SEND-\/DM"{}};}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00050}00050             cmd\_params-\/>\mbox{\hyperlink{structcommand__parameters_a1d5849d3100a3edfcf71b7f6d93d1fd7}{nb\_parameters}} = 1;}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00051}00051             cmd\_params-\/>\mbox{\hyperlink{structcommand__parameters_a3f1b143d5bfbd65ef665826a134dc7c0}{parameters\_name}} = \mbox{\hyperlink{epoll__server_2utils_2xalloc_8c_af7b6b8fd37a3c4b944c71b783d50fc96}{xmalloc}}(1, \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{char} **));}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00052}00052             cmd\_params-\/>\mbox{\hyperlink{structcommand__parameters_a3f1b143d5bfbd65ef665826a134dc7c0}{parameters\_name}}[0] = strdup(\textcolor{stringliteral}{"{}User"{}});}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00053}00053         \}}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00054}00054 }
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00055}00055         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (strcmp(command\_string, \textcolor{stringliteral}{"{}CREATE-\/ROOM"{}}) == 0)}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00056}00056             cmd\_params-\/>\mbox{\hyperlink{structcommand__parameters_ade9cba72805fe52685a1deea307a8e82}{command}} = \textcolor{stringliteral}{"{}CREATE-\/ROOM"{}};}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00057}00057         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (strcmp(command\_string, \textcolor{stringliteral}{"{}LIST-\/ROOMS"{}}) == 0)}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00058}00058             cmd\_params-\/>\mbox{\hyperlink{structcommand__parameters_ade9cba72805fe52685a1deea307a8e82}{command}} = \textcolor{stringliteral}{"{}LIST-\/ROOMS"{}};}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00059}00059         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (strcmp(command\_string, \textcolor{stringliteral}{"{}JOIN-\/ROOM"{}}) == 0)}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00060}00060             cmd\_params-\/>\mbox{\hyperlink{structcommand__parameters_ade9cba72805fe52685a1deea307a8e82}{command}} = \textcolor{stringliteral}{"{}JOIN-\/ROOM"{}};}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00061}00061         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (strcmp(command\_string, \textcolor{stringliteral}{"{}LEAVE-\/ROOM"{}}) == 0)}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00062}00062             cmd\_params-\/>\mbox{\hyperlink{structcommand__parameters_ade9cba72805fe52685a1deea307a8e82}{command}} = \textcolor{stringliteral}{"{}LEAVE-\/ROOM"{}};}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00063}00063         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (strcmp(command\_string, \textcolor{stringliteral}{"{}SEND-\/ROOM"{}}) == 0)}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00064}00064         \{}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00065}00065             cmd\_params-\/>\mbox{\hyperlink{structcommand__parameters_ade9cba72805fe52685a1deea307a8e82}{command}} = \textcolor{stringliteral}{"{}SEND-\/ROOM"{}};}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00066}00066             cmd\_params-\/>\mbox{\hyperlink{structcommand__parameters_a1d5849d3100a3edfcf71b7f6d93d1fd7}{nb\_parameters}} = 1;}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00067}00067             cmd\_params-\/>\mbox{\hyperlink{structcommand__parameters_a3f1b143d5bfbd65ef665826a134dc7c0}{parameters\_name}} = \mbox{\hyperlink{epoll__server_2utils_2xalloc_8c_af7b6b8fd37a3c4b944c71b783d50fc96}{xmalloc}}(1, \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{char} **));}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00068}00068             cmd\_params-\/>\mbox{\hyperlink{structcommand__parameters_a3f1b143d5bfbd65ef665826a134dc7c0}{parameters\_name}}[0] = strdup(\textcolor{stringliteral}{"{}Room"{}});}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00069}00069         \}}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00070}00070         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (strcmp(command\_string, \textcolor{stringliteral}{"{}DELETE-\/ROOM"{}}) == 0)}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00071}00071             cmd\_params-\/>\mbox{\hyperlink{structcommand__parameters_ade9cba72805fe52685a1deea307a8e82}{command}} = \textcolor{stringliteral}{"{}DELETE-\/ROOM"{}};}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00072}00072         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (strcmp(command\_string, \textcolor{stringliteral}{"{}PROFILE"{}}) == 0)}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00073}00073             cmd\_params-\/>\mbox{\hyperlink{structcommand__parameters_ade9cba72805fe52685a1deea307a8e82}{command}} = \textcolor{stringliteral}{"{}PROFILE"{}};}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00074}00074     \}}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00075}00075     \textcolor{keywordflow}{return} cmd\_params;}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00076}00076 \}}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00077}00077 }
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00078}00078 \textcolor{keyword}{static} \textcolor{keywordtype}{void} free\_command\_parameters\_info(\textcolor{keyword}{struct} \mbox{\hyperlink{structcommand__parameters}{command\_parameters}} *cmd\_params)}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00079}00079 \{}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00080}00080     \textcolor{keywordflow}{for} (uint8\_t i = 0; i < cmd\_params-\/>\mbox{\hyperlink{structcommand__parameters_a1d5849d3100a3edfcf71b7f6d93d1fd7}{nb\_parameters}}; i++)}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00081}00081         free(cmd\_params-\/>\mbox{\hyperlink{structcommand__parameters_a3f1b143d5bfbd65ef665826a134dc7c0}{parameters\_name}}[i]);}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00082}00082     free(cmd\_params-\/>\mbox{\hyperlink{structcommand__parameters_a3f1b143d5bfbd65ef665826a134dc7c0}{parameters\_name}});}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00083}00083     free(cmd\_params);}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00084}00084 \}}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00085}00085 }
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00086}\mbox{\hyperlink{read__from__stdin_8h_a12dd841eebca77e40e225f37da7f778e}{00086}} \textcolor{keywordtype}{void} \mbox{\hyperlink{read__from__stdin_8c_a12dd841eebca77e40e225f37da7f778e}{read\_from\_stdin}}(\textcolor{keywordtype}{int} \mbox{\hyperlink{read__from__stdin_8c_a9329c4790c307301a22f6d23cdc23edd}{server\_socket}})}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00087}00087 \{}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00088}00088     \textcolor{keywordflow}{do}}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00089}00089     \{}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00090}00090         \textcolor{keyword}{struct }\mbox{\hyperlink{structmessage}{message}} *\mbox{\hyperlink{structmessage}{message}} =}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00091}00091             \mbox{\hyperlink{message_8h_abeba53932f51cf0ac12dd3a1dc8bf1ff}{init\_message}}(\mbox{\hyperlink{message_8h_ad6c5c0fc281afcd9ebf73e88020c835fa7c38dee28cc443c7d05d01fdd48666cc}{REQUEST\_MESSAGE\_CODE}}); \textcolor{comment}{// Initializing struct message}}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00092}00092         \textcolor{keywordflow}{if} (!\mbox{\hyperlink{structmessage}{message}})}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00093}00093         \{}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00094}00094             close(\mbox{\hyperlink{read__from__stdin_8c_a9329c4790c307301a22f6d23cdc23edd}{server\_socket}});}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00095}00095             \mbox{\hyperlink{logger_8h_aa3c3e5e89264af119696a729635581e4}{raise\_panic}}(EXIT\_FAILURE,}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00096}00096                         \textcolor{stringliteral}{"{}Error while allocating memory\(\backslash\)n"{}}); \textcolor{comment}{// Exiting properly}}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00097}00097         \}}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00098}00098 }
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00099}00099         \textcolor{keywordtype}{char} \mbox{\hyperlink{structmessage_ade9cba72805fe52685a1deea307a8e82}{command}}[\mbox{\hyperlink{basic__client_8h_a6e576a3c6530636d68b7a220480bcd32}{DEFAULT\_BUFFER\_SIZE}}];}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00100}00100         fprintf(stdout, \textcolor{stringliteral}{"{}Command:\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00101}00101         fgets(\mbox{\hyperlink{structmessage_ade9cba72805fe52685a1deea307a8e82}{command}}, \mbox{\hyperlink{basic__client_8h_a6e576a3c6530636d68b7a220480bcd32}{DEFAULT\_BUFFER\_SIZE}}, stdin); \textcolor{comment}{// Get user input}}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00102}00102         \mbox{\hyperlink{structmessage_ade9cba72805fe52685a1deea307a8e82}{command}}[strcspn(\mbox{\hyperlink{structmessage_ade9cba72805fe52685a1deea307a8e82}{command}}, \textcolor{stringliteral}{"{}\(\backslash\)n"{}})] = 0; \textcolor{comment}{// parse the newline}}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00103}00103 }
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00104}00104         \textcolor{keyword}{struct }\mbox{\hyperlink{structcommand__parameters}{command\_parameters}} *cmd\_params =}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00105}00105             get\_command\_parameters\_info(\mbox{\hyperlink{structcommand__parameters_ade9cba72805fe52685a1deea307a8e82}{command}});}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00106}00106 }
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00107}00107         \textcolor{keywordflow}{if} (cmd\_params-\/>\mbox{\hyperlink{structcommand__parameters_ade9cba72805fe52685a1deea307a8e82}{command}}) \textcolor{comment}{// If the command is valid}}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00108}00108         \{}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00109}00109             \mbox{\hyperlink{structmessage}{message}}-\/>\mbox{\hyperlink{structmessage_ade9cba72805fe52685a1deea307a8e82}{command}} = \mbox{\hyperlink{epoll__server_2utils_2xalloc_8c_af7b6b8fd37a3c4b944c71b783d50fc96}{xmalloc}}(strlen(\mbox{\hyperlink{structcommand__parameters_ade9cba72805fe52685a1deea307a8e82}{command}}) + 1, \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{char}));}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00110}00110             \mbox{\hyperlink{structmessage}{message}}-\/>\mbox{\hyperlink{structmessage_a6f6d728707a09ca3f6280160f9dceee0}{nb\_parameters}} = 0;}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00111}00111 }
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00112}00112             strcpy(\mbox{\hyperlink{structmessage}{message}}-\/>\mbox{\hyperlink{structmessage_ade9cba72805fe52685a1deea307a8e82}{command}}, \mbox{\hyperlink{structcommand__parameters_ade9cba72805fe52685a1deea307a8e82}{command}});}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00113}00113 }
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00114}00114             \textcolor{keywordflow}{if} (cmd\_params-\/>\mbox{\hyperlink{structcommand__parameters_a1d5849d3100a3edfcf71b7f6d93d1fd7}{nb\_parameters}} > 0)}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00115}00115             \{}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00116}00116                 \textcolor{keywordtype}{char} parameters[\mbox{\hyperlink{basic__client_8h_a6e576a3c6530636d68b7a220480bcd32}{DEFAULT\_BUFFER\_SIZE}}] = \{ 0 \};}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00117}00117                 uint8\_t entered\_params = 0;}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00118}00118 }
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00119}00119                 fprintf(stdout, \textcolor{stringliteral}{"{}Parameters:\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00120}00120                 \textcolor{keywordflow}{while} (1)}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00121}00121                 \{}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00122}00122                     fgets(parameters, \mbox{\hyperlink{basic__client_8h_a6e576a3c6530636d68b7a220480bcd32}{DEFAULT\_BUFFER\_SIZE}}, stdin);}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00123}00123 }
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00124}00124                     \textcolor{keywordflow}{if} (parameters[0] == \textcolor{charliteral}{'\(\backslash\)n'})}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00125}00125                         \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00126}00126 }
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00127}00127                     \textcolor{keywordtype}{char} *key;}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00128}00128                     \textcolor{keywordtype}{char} *value;}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00129}00129 }
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00130}00130                     \textcolor{comment}{// Get a "{}key=value"{} pair using}}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00131}00131                     \textcolor{comment}{// get\_message\_next\_parameter\_kv (witch also works in this}}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00132}00132                     \textcolor{comment}{// case)}}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00133}00133                     \mbox{\hyperlink{message_8h_a28d4651376c79b584f48cf6ea0e2089a}{get\_message\_next\_parameter\_kv}}(parameters, \&key, \&value);}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00134}00134                     \textcolor{keywordtype}{bool} parameterFound = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00135}00135                     \textcolor{keywordflow}{for} (uint8\_t i = 0; i < cmd\_params-\/>\mbox{\hyperlink{structcommand__parameters_a1d5849d3100a3edfcf71b7f6d93d1fd7}{nb\_parameters}}; i++)}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00136}00136                     \{}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00137}00137                         \textcolor{keywordflow}{if} (key}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00138}00138                             \&\& strcmp(key, cmd\_params-\/>\mbox{\hyperlink{structcommand__parameters_a3f1b143d5bfbd65ef665826a134dc7c0}{parameters\_name}}[i]) == 0)}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00139}00139                         \{}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00140}00140                             parameterFound = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00141}00141                             \mbox{\hyperlink{structmessage}{message}}-\/>\mbox{\hyperlink{structmessage_ad5c217513154f9cdd331b82efc6351cf}{command\_parameters}} =}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00142}00142                                 \mbox{\hyperlink{epoll__server_2utils_2xalloc_8c_af1634ff7d575d04a5ad3bd26343b4e51}{xrealloc}}(\mbox{\hyperlink{structmessage}{message}}-\/>\mbox{\hyperlink{structmessage_ad5c217513154f9cdd331b82efc6351cf}{command\_parameters}},}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00143}00143                                          \mbox{\hyperlink{structmessage}{message}}-\/>\mbox{\hyperlink{structmessage_a6f6d728707a09ca3f6280160f9dceee0}{nb\_parameters}} + 1,}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00144}00144                                          \textcolor{keyword}{sizeof}(\textcolor{keyword}{struct} \mbox{\hyperlink{structcommand__parameter}{command\_parameter}}));}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00145}00145 }
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00146}00146                             \mbox{\hyperlink{structmessage}{message}}-\/>\mbox{\hyperlink{structmessage_ad5c217513154f9cdd331b82efc6351cf}{command\_parameters}}[entered\_params].\mbox{\hyperlink{structcommand__parameter_a5892a9181e6a332f84d27aecd41dcd12}{key}} =}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00147}00147                                 strdup(key);}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00148}00148                             \mbox{\hyperlink{structmessage}{message}}-\/>\mbox{\hyperlink{structmessage_ad5c217513154f9cdd331b82efc6351cf}{command\_parameters}}[entered\_params].\mbox{\hyperlink{structcommand__parameter_a0f61d63b009d0880a89c843bd50d8d76}{value}} =}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00149}00149                                 strdup(value);}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00150}00150 }
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00151}00151                             \mbox{\hyperlink{structmessage}{message}}-\/>\mbox{\hyperlink{structmessage_a6f6d728707a09ca3f6280160f9dceee0}{nb\_parameters}} = ++entered\_params;}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00152}00152                             \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00153}00153                         \}}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00154}00154                     \}}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00155}00155 }
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00156}00156                     \textcolor{keywordflow}{if} (!parameterFound)}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00157}00157                     \{}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00158}00158                         fprintf(stderr, \textcolor{stringliteral}{"{}Invalid parameter\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00159}00159                         \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00160}00160                     \}}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00161}00161                 \}}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00162}00162             \}}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00163}00163         \}}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00164}00164         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00165}00165         \{}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00166}00166             fprintf(stderr, \textcolor{stringliteral}{"{}Invalid command\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00167}00167             \mbox{\hyperlink{message_8h_a5bcae38822e01fd2316aede529617559}{free\_partial\_message}}(\mbox{\hyperlink{structmessage}{message}});}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00168}00168             free\_command\_parameters\_info(cmd\_params);}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00169}00169             \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00170}00170         \}}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00171}00171 }
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00172}00172         \textcolor{keywordflow}{do}}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00173}00173         \{}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00174}00174             \textcolor{keywordtype}{char} *payload = \mbox{\hyperlink{structcommand__parameters_ade9cba72805fe52685a1deea307a8e82}{command}}; \textcolor{comment}{// Reuse the command buffer}}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00175}00175             fprintf(stdout, \textcolor{stringliteral}{"{}Payload:\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00176}00176             fgets(payload, \mbox{\hyperlink{basic__client_8h_a6e576a3c6530636d68b7a220480bcd32}{DEFAULT\_BUFFER\_SIZE}}, stdin); \textcolor{comment}{// Get user input}}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00177}00177             payload[strcspn(payload, \textcolor{stringliteral}{"{}\(\backslash\)n"{}})] = 0; \textcolor{comment}{// Eliminate the newline}}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00178}00178 }
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00179}00179             \textcolor{keywordflow}{if} (strcmp(payload, \textcolor{stringliteral}{"{}/quit"{}}) != 0)}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00180}00180             \{}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00181}00181                 \mbox{\hyperlink{structmessage}{message}}-\/>\mbox{\hyperlink{structmessage_a18f141cb2726073503afb9f1d6c85efb}{payload}} = strdup(payload);}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00182}00182                 \mbox{\hyperlink{structmessage}{message}}-\/>\mbox{\hyperlink{structmessage_aac1f7a36891dde68709d58926289458a}{payload\_size}} = strlen(payload);}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00183}00183 }
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00184}00184                 \textcolor{keywordtype}{char} *serialized\_message = \mbox{\hyperlink{message_8h_a4b7e770d6370564c3fcdab29984e8ae0}{compose\_message}}(\mbox{\hyperlink{structmessage}{message}});}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00185}00185                 \textcolor{keywordflow}{if} (serialized\_message)}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00186}00186                 \{}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00187}00187                     \mbox{\hyperlink{safe__io_8h_a3730804c00874106746163562e2693ac}{safe\_send}}(\mbox{\hyperlink{read__from__stdin_8c_a9329c4790c307301a22f6d23cdc23edd}{server\_socket}}, serialized\_message,}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00188}00188                               strlen(serialized\_message), MSG\_EOR);}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00189}00189                     free(serialized\_message);}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00190}00190                 \}}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00191}00191                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00192}00192                 \{}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00193}00193                     close(\mbox{\hyperlink{read__from__stdin_8c_a9329c4790c307301a22f6d23cdc23edd}{server\_socket}});}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00194}00194                     \mbox{\hyperlink{logger_8h_aa3c3e5e89264af119696a729635581e4}{raise\_panic}}(EXIT\_FAILURE,}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00195}00195                                 \textcolor{stringliteral}{"{}Error while serializing message\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00196}00196                 \}}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00197}00197             \}}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00198}00198             \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00199}00199                 cmd\_params-\/>\mbox{\hyperlink{structcommand__parameters_a218054f50dabee86e0bb149961430370}{loop\_payload}} = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00200}00200         \} \textcolor{keywordflow}{while} (cmd\_params-\/>\mbox{\hyperlink{structcommand__parameters_a218054f50dabee86e0bb149961430370}{loop\_payload}});}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00201}00201 }
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00202}00202         free\_command\_parameters\_info(cmd\_params);}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00203}00203         \mbox{\hyperlink{message_8h_aafafca753919c7d770812f5c47b5fe7f}{free\_message}}(\mbox{\hyperlink{structmessage}{message}});}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00204}00204 }
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00205}00205     \} \textcolor{keywordflow}{while} (1);}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00206}00206 \}}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00207}00207 }
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00208}\mbox{\hyperlink{read__from__stdin_8h_aae4c2c08a6014ef154dba3a468584846}{00208}} \textcolor{keywordtype}{void} *\mbox{\hyperlink{read__from__stdin_8c_aae4c2c08a6014ef154dba3a468584846}{read\_from\_stdin\_thread}}(\textcolor{keywordtype}{void} *none)}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00209}00209 \{}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00210}00210     (void)none;}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00211}00211     \textcolor{keywordtype}{int} s = \mbox{\hyperlink{read__from__stdin_8c_a9329c4790c307301a22f6d23cdc23edd}{server\_socket}};}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00212}00212     \mbox{\hyperlink{read__from__stdin_8c_a12dd841eebca77e40e225f37da7f778e}{read\_from\_stdin}}(s);}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00213}00213     \textcolor{keywordflow}{return} NULL;}
\DoxyCodeLine{\Hypertarget{read__from__stdin_8c_source_l00214}00214 \}}

\end{DoxyCode}
